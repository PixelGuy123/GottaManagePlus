<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d" d:DesignWidth="1080" d:DesignHeight="720"
    xmlns:vm="clr-namespace:GottaManagePlus.ViewModels"
    xmlns:models="using:GottaManagePlus.Models"
    xmlns:converters="using:GottaManagePlus.Styles.Converters"
    x:Class="GottaManagePlus.Views.MyModsView"
    x:DataType="vm:MyModsViewModel">
    <Design.DataContext>
        <vm:MyModsViewModel />
    </Design.DataContext>
    <Design.DesignStyle>
        <StyleInclude Source="/Styles/style.axaml" />
    </Design.DesignStyle>
    
    <UserControl.Resources>
        <ResourceDictionary>
            <Bitmap x:Key="DefaultThumbnail">/Assets/UI/Image_Mod_NoThumbnail.png</Bitmap>
            <ResourceDictionary.MergedDictionaries>
                <ResourceInclude Source="/Styles/ProfileVisualization/ProfileResources.axaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <UserControl.Styles>
        <StyleInclude Source="/Styles/style.axaml" />
        <!--MOD VIEWER STYLING-->
        <Style Selector=":is(Control).ModViewerHeader">
            <Setter Property="VerticalAlignment" Value="{Binding $parent[StackPanel].VerticalAlignment, Mode=OneWay}" />
        </Style>
        <!--MOD NAME STYLING-->
        <Style Selector=":is(TextBlock).ModLabel">
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="FontFamily" Value="{StaticResource ComicRelief}" />
            <Setter Property="TextAlignment" Value="Center" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
        </Style>
    </UserControl.Styles>

    <!-- Content Below -->
    <!-- START of Mod List-->
    <Border
        Name="BodyBorder"
        Classes="Menu_Border AllCornerRadius"
        BoxShadow="0 3 10 2 #7D000000">
        <Border
            Classes="Menu_Border AllCornerRadius"
            ClipToBounds="True">
            <Grid RowDefinitions="Auto, *">
                <Border Grid.Row="0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Classes="Menu_Header">
                    <Border.Background>
                        <ImageBrush
                            Source="/Assets/UI/Icon_ModsBg.png"
                            TileMode="Tile"
                            Stretch="None"
                            DestinationRect="-32 34 64 64"
                            Opacity="0.175" />
                    </Border.Background>
                </Border>
                <!-- Mod Header -->
                <Grid Grid.Row="0"
                      Margin="0 5"
                      ColumnDefinitions="Auto, *">
                    <StackPanel Grid.Column="0" 
                                Spacing="15"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Left">
                        <Panel> <!-- Stack TextBlocks together -->
                            <!--TEMP COMMENT: USE LANGUAGE HERE-->
                            <TextBlock
                                Text="Installed Mods"
                                Foreground="White"
                                FontWeight="UltraBold"
                                Classes="SideMenu-Label RightHeader GlowShadow" />
                            <TextBlock
                                Text="Installed Mods"
                                Classes="SideMenu-Label RightHeader" />
                        </Panel>
                    </StackPanel>
                    <StackPanel
                        Grid.Column="1"
                        Spacing="10"
                        HorizontalAlignment="Right"
                        Margin="10 0"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <!--TEMP COMMENT: USE LANGUAGE HERE-->
                        <!--Scroll viewer search box-->
                        <Button
                            Margin="10 0"
                            Classes="ModViewerHeader YCTPButton">
                            <Image
                                Source="/Assets/UI/Icon_AddModContainer.png"
                                Width="32"
                                Height="32" />
                        </Button>
                        <AutoCompleteBox
                            Classes="ModViewerHeader"
                            Width="250"
                            Watermark="Search"
                            ItemsSource="{Binding ObservableUnchangedMods, Mode=OneWay}"
                            SelectedItem="{Binding CurrentModItem}"
                            Text="{Binding Text}"
                            ValueMemberBinding="{Binding ModName, DataType=models:ModItem, Mode=OneWay}"
                            FilterMode="Contains" />
                        <Button
                            Classes="ModViewerHeader YCTPButton"
                            Command="{CompiledBinding ResetSearch}">
                            <Image
                                Source="/Assets/UI/Icon_Cancel_Generic.png"
                                Width="32"
                                Height="32" />
                        </Button>
                        <!-- Current version display -->
                        <TextBlock 
                            Foreground="PowderBlue"
                            FontWeight="Bold"
                            TextDecorations="Underline"
                            FontSize="22"
                            FontFamily="{StaticResource ComicRelief}"
                            Text="{CompiledBinding CurrentPlusVersion, Mode=OneWay}"
                            Classes="SideMenu-Label"/>
                    </StackPanel>
                </Grid>

                <!-- Actual Mod Scroll Viewer -->
                <ScrollViewer Name="ModsScrollViewer"
                              Grid.Row="1"
                              Background="{DynamicResource ModsListBg}">
                    <Panel>
                        <TextBlock Name="NoModTextIndicator"
                                   IsVisible="{CompiledBinding !HasAnyModsToDisplay, Mode=OneWay}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Opacity="0.35"
                                   FontFamily="{StaticResource ComicRelief}"
                                   Text="No mods available!">
                            <TextBlock.RenderTransform>
                                <RotateTransform Angle="12.5" />
                            </TextBlock.RenderTransform>
                        </TextBlock>

                        <ItemsRepeater IsVisible="{CompiledBinding HasAnyModsToDisplay, Mode=OneWay}"
                                       ItemsSource="{CompiledBinding ObservableMods, Mode=OneWay}">
                            <ItemsRepeater.Layout>
                                <UniformGridLayout ItemsStretch="Fill" 
                                                   Orientation="Horizontal" 
                                                   MaximumRowsOrColumns="{CompiledBinding NumberOfModsPerRow, Mode=OneTime}" 
                                                   MinItemWidth="150" 
                                                   MinItemHeight="250"
                                                   MinColumnSpacing="10" 
                                                   MinRowSpacing="10" />
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:ModItem}">
                                    <Border
                                            Padding="14 4"
                                            CornerRadius="35"
                                            ClipToBounds="True"
                                            BorderThickness="5"
                                            Background="Black"
                                            BorderBrush="{DynamicResource YctpBg}">
                                        <Grid
                                            RowDefinitions="Auto, *, Auto">
                                            <!-- Metadata Display -->
                                            <StackPanel
                                                Grid.Row="0"
                                                VerticalAlignment="Top"
                                                Orientation="Vertical">
                                                <!-- Mod Name display -->
                                                <TextBlock
                                                    MaxHeight="75"
                                                    Classes="ModLabel"
                                                    Text="{CompiledBinding ModName, Mode=OneWay}"
                                                    FontSize="{CompiledBinding ModName, Converter={x:Static converters:FontConverters.Max20TextToSizeConverter}, Mode=OneWay}"/>
                                                <!-- Version and Support display -->
                                                <TextBlock
                                                    Foreground="{CompiledBinding SupportsCurrentVersion, Mode=OneWay, Converter={x:Static converters:ForegroundConverters.BoolToColor}}"
                                                    FontSize="12"
                                                    Text="{CompiledBinding MetaData.Version, FallbackValue=0.0.0, Mode=OneWay}"
                                                    Classes="ModLabel"/>
                                                <!-- Supports -->
                                                <TextBlock
                                                    IsVisible="{CompiledBinding SupportsCurrentVersion, Mode=OneWay}"
                                                    Foreground="{CompiledBinding SupportsCurrentVersion, Mode=OneWay, Converter={x:Static converters:ForegroundConverters.BoolToColor}}"
                                                    Classes="ModLabel"
                                                    FontWeight="Bold"
                                                    TextTrimming="None"
                                                    TextWrapping="WrapWithOverflow"
                                                    Text="Supports this version."
                                                    FontSize="10"/>
                                                <!-- NOT Support -->
                                                <TextBlock
                                                    IsVisible="{CompiledBinding !SupportsCurrentVersion, Mode=OneWay}"
                                                    Foreground="{CompiledBinding SupportsCurrentVersion, Mode=OneWay, Converter={x:Static converters:ForegroundConverters.BoolToColor}}"
                                                    Classes="ModLabel"
                                                    FontWeight="Bold"
                                                    TextTrimming="None"
                                                    TextWrapping="WrapWithOverflow"
                                                    Text="Doesn't support this version."
                                                    FontSize="10">
                                                </TextBlock>
                                            </StackPanel>
                                            <!-- Image Display -->
                                            <Border Grid.Row="1" Margin="5"
                                                    MaxWidth="{CompiledBinding MaxHeight, RelativeSource={RelativeSource Self}, Mode=OneWay}"
                                                    MaxHeight="128"
                                                    Padding="10"
                                                    CornerRadius="10"
                                                    ClipToBounds="True"
                                                    BorderThickness="5"
                                                    BorderBrush="{DynamicResource YctpBg-Selected}">
                                                <Border.Background>
                                                    <ImageBrush
                                                        Stretch="UniformToFill"
                                                        Source="{CompiledBinding Thumbnail, TargetNullValue={StaticResource DefaultThumbnail}, Mode=OneWay}"/>
                                                </Border.Background>
                                            </Border>
                                            <!-- Button Display -->
                                            <StackPanel Grid.Row="2"
                                                        Orientation="Horizontal"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Spacing="35">

                                                <Button Classes="YCTPButton"
                                                        HorizontalAlignment="Left"
                                                        Command="{CompiledBinding ((vm:MyModsViewModel)DataContext).OpenModPath, RelativeSource={RelativeSource FindAncestor, AncestorType=ItemsRepeater}}"
                                                        CommandParameter="{CompiledBinding Id, Mode=OneWay}">
                                                    <Image 
                                                        Width="32"
                                                        Height="32"
                                                        Source="/Assets/UI/Icon_SelectFolder.png"/>
                                                </Button>

                                                <Button Classes="YCTPButton"
                                                        HorizontalAlignment="Right"
                                                        Command="{CompiledBinding ((vm:MyModsViewModel)DataContext).DeleteModItem, RelativeSource={RelativeSource FindAncestor, AncestorType=ItemsRepeater}}"
                                                        CommandParameter="{CompiledBinding Id, Mode=OneWay}">
                                                    <Image
                                                        Width="32"
                                                        Height="32"
                                                        Source="/Assets/UI/Icon_DeleteMod.png"/>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </Panel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Border>
    <!-- END of Mod List -->

</UserControl>